<?php/*Plugin Name: Certificados para Iniciação Científica - Confict 2012Version: 1.0Plugin URI:Author: Marcus Ribeiro PerroutAuthor URI: http://www.perrout.com.brDescription: Certificados para Confict 2012*/session_start();/* Formulário para Resumo */function template_certificados($idForm,$data=''){	  global $current_user; 	  $content="		<script type='text/javascript'>			var win = null;			function NovaJanela(pagina,nome,w,h,scroll){				LeftPosition = (screen.width) ? (screen.width-w)/2 : 0;				TopPosition = (screen.height) ? (screen.height-h)/2 : 0;				settings = 'height='+h+',width='+w+',top='+TopPosition+',left='+LeftPosition+',scrollbars='+scroll+',resizable'				window.open(pagina,nome,settings);			}		</script>		";	return $content;}function gerar_certificados() {	global $current_user;	if(@$current_user->ID){		$getURL = "http://".$_SERVER['HTTP_HOST'].$_SERVER['PHP_SELF'];		$url = str_replace('index.php', '', $getURL);		$content="			<script type='text/javascript'>				var win = null;				function NovaJanela(pagina,nome,w,h,scroll){					LeftPosition = (screen.width) ? (screen.width-w)/2 : 0;					TopPosition = (screen.height) ? (screen.height-h)/2 : 0;					settings = 'height='+h+',width='+w+',top='+TopPosition+',left='+LeftPosition+',scrollbars='+scroll+',resizable'					win = window.open(pagina,nome,settings);				}			</script>		";		if ($current_user->certificados == "SIM") {			$content.= "<h2><a href=\"".$url."wp-content/plugins/confict-2012/ic-imprimir.php?page=ic-certificado&minicurso-id=".$certificados->minicurso_id."&inscrito=".$current_user->display_name."&horas=".$certificados->minicurso_carga."&instituicao=".$current_user->instituicao_ensino."&tipo=C\" onclick=\"NovaJanela(this.href,'Certificados','700','600','yes');return false\">IV Congresso Fluminense de Iniciação Científica e Tecnológica</a></h2>";		}		$dados = existe_certificado($current_user->user_email);		if ($dados != null) {				foreach($dados as $certificados){									$content.= "<h2><a href=\"".$url."wp-content/plugins/confict-2012/ic-imprimir.php?page=ic-certificado&minicurso-id=".$certificados->minicurso_id."&inscrito=".$current_user->display_name."&horas=".$certificados->minicurso_carga."&instituicao=".$current_user->instituicao_ensino."&tipo=M\" onclick=\"NovaJanela(this.href,'Certificados','700','600','yes');return false\">".$certificados->minicurso_tema."</a></h2>";								}					}		if($dados == null AND $current_user->certificados == null){			$content.= "Não há certificado(s) para você.";		}    }else{		echo "Você precisa estar logado para poder imprimir os Certificados do Encontro";	    }return $content;}function existe_certificado($email){	global $wpdb;	$sql="select * from wp_minicursos where minicurso_certificado like '%".$email."%'";	return $resultados = $wpdb->get_results($sql);}add_shortcode('certificados', 'gerar_certificados');?>